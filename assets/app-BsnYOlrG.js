const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/verify-DHN7ZqrI.js","assets/_commonjsHelpers-Cpj98o6Y.js"])))=>i.map(i=>d[i]);
const at="modulepreload",st=function(e){return"/"+e},Ae={},W=function(t,n,r){let o=Promise.resolve();if(n&&n.length>0){let p=function(v){return Promise.all(v.map(b=>Promise.resolve(b).then(E=>({status:"fulfilled",value:E}),E=>({status:"rejected",reason:E}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),m=d?.nonce||d?.getAttribute("nonce");o=p(n.map(v=>{if(v=st(v),v in Ae)return;Ae[v]=!0;const b=v.endsWith(".css"),E=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${E}`))return;const C=document.createElement("link");if(C.rel=b?"stylesheet":at,b||(C.as="script"),C.crossOrigin="",C.href=v,m&&C.setAttribute("nonce",m),document.head.appendChild(C),b)return new Promise((x,I)=>{C.addEventListener("load",x),C.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${v}`)))})}))}function a(d){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=d,window.dispatchEvent(m),!m.defaultPrevented)throw d}return o.then(d=>{for(const m of d||[])m.status==="rejected"&&a(m.reason);return t().catch(a)})};function it(){const e=document.getElementById("zflex-data");if(!e||!e.textContent)return console.warn("[Core/API] Tunnel de data #zflex-data est vide ou introuvable."),{};try{return JSON.parse(e.textContent)}catch(t){return console.error("[Core/API] Erreur de parsing du tunnel de data #zflex-data:",t),{}}}async function A(e,t){const r=it().apiEndpoints?.[e];if(!r)throw new Error(`Endpoint API pour "${e}" non trouv√©. V√©rifiez la configuration du builder.`);try{const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await o.json();if(!o.ok){const d=a.error||`Erreur ${o.status}`;throw new Error(d)}return a}catch(o){throw console.error(`[API] Erreur pour "${e}":`,o),new Error("La communication avec nos services a √©chou√©. Veuillez r√©essayer.")}}function Re(e,t={}){return A("createConv",{storeId:e,context:t})}function ct(e,t,n,r){return A("stacy",{storeId:e,convId:t,message:n,contextDelta:r})}function qe(e,t,n){return A("continueConv",{storeId:e,convId:t,functionCallResult:n})}function gn(e,t){return A("createOrder",{...e,storeId:t})}function yn(e,t){return A("getOrderDetails",{orderId:e,storeId:t})}function hn(e,t,n,r,o){return A("initiatePayment",{orderId:e,storeId:t,paymentMethod:n,paymentPhone:r,transactionReference:o})}function vn(e,t){return A("getOrderStatusApi",{orderId:e,storeId:t})}function wn(e,t){return A("getProspectInfo",{storeId:e,prospectId:t})}function lt(e,t){return A("subscribeToNewsletter",{email:e,storeId:t})}function dt(e,t){return A("trackEvent",{storeId:e,events:t})}let ne=null;async function je(){if(ne)return ne;try{const e=await fetch("/api/search-index.json");if(!e.ok)throw new Error(`Erreur r√©seau: ${e.statusText}`);return ne=await e.json(),ne||[]}catch(e){return console.error("[Core/API] Impossible de charger l'index des produits:",e),[]}}const Z=window.zflexEventBus||new EventTarget;window.zflexEventBus=Z;const Ve="zflex_cart";function V(){const e=localStorage.getItem(Ve);return e?JSON.parse(e):[]}function ue(e){localStorage.setItem(Ve,JSON.stringify(e)),window.dispatchEvent(new CustomEvent("cartUpdated"))}function xe(e,t=1){const n=V(),r=n.find(o=>o.id===e.id);r?r.quantity+=t:n.push({...e,quantity:t}),ue(n)}function Fe(e,t){let n=V();const r=n.find(o=>o.id===e);r&&(t>0?r.quantity=t:n=n.filter(o=>o.id!==e),ue(n))}function Ie(e){const t=V().filter(n=>n.id!==e);ue(t)}function ut(){ue([])}function $e(){const e=document.getElementById("cart-count");if(!e)return;const n=V().reduce((r,o)=>r+o.quantity,0);e.textContent=String(n),e.style.display=n>0?"flex":"none",n>0&&(e.classList.add("updated"),setTimeout(()=>{e.classList.remove("updated")},300))}function Ue(){if(!document.querySelector('[data-page-type="cart"]'))return;const t=document.getElementById("cart-items-list"),n=document.getElementById("cart-subtotal"),r=document.getElementById("cart-total"),o=document.getElementById("cart-empty-state"),a=document.getElementById("cart-content");if(!t||!n||!r||!o||!a){console.error("[Cart] Erreur critique: DOM manquant dans cart.njk.");return}const d=V(),m=document.getElementById("cart-item-template");if(!m){console.error("[Cart] Erreur critique: le template #cart-item-template est manquant.");return}if(d.length===0){o.classList.remove("hidden"),a.classList.add("hidden");return}o.classList.add("hidden"),a.classList.remove("hidden"),t.innerHTML="";let p={};d.forEach(v=>{const b=Number(v.price?.amount||0),E=v.price?.currency||"EUR",C=Number(v.quantity||1),x=m.content.cloneNode(!0),I=x.querySelector('[data-template-field="image"]');I&&(I.src=v.coverImage||"");const N=x.querySelector('[data-template-field="title"]');N&&(N.textContent=v.title||"Produit sans nom");const q=x.querySelector('[data-template-field="url"]');q&&(q.href=v.url||"#");const $=x.querySelector('[data-template-field="price"]');$&&($.textContent=`${b.toFixed(2)} ${E}`);const B=x.querySelector('[data-template-field="quantity"]');B&&(B.value=String(C),B.addEventListener("change",()=>Fe(v.id,parseInt(B.value,10))));const L=x.querySelector('[data-template-field="total"]');L&&(L.textContent=`${(b*C).toFixed(2)} ${E}`);const te=x.querySelector('[data-template-field="remove-btn"]');te&&te.addEventListener("click",()=>Ie(v.id)),t.appendChild(x),p[E]||(p[E]=0),p[E]+=b*C}),n.innerHTML="",r.innerHTML="",Object.entries(p).forEach(([v,b])=>{const E=`${Number(b).toFixed(2)} ${v}`;n.innerHTML+=`<div>${E}</div>`,r.innerHTML+=`<div>${E}</div>`})}function ft(){document.querySelector('[data-page-type="cart"]')&&(console.log("[Cart] Initialisation de la page panier..."),Ue())}async function mt(){document.querySelectorAll("#add-to-cart-btn").forEach(t=>{const n=t;n.dataset.listenerAttached||(n.addEventListener("click",async()=>{n.disabled=!0;try{const r=document.getElementById("zflex-data");if(!r)throw new Error("Erreur critique: Tunnel de data #zflex-data manquant.");const o=JSON.parse(r.textContent||"{}");if(!o?.product)throw new Error("Donn√©es du produit non trouv√©es dans le tunnel de data.");const d=(await je()).find(m=>m.id===o.product.id);if(d)xe(d),Z.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"Ajout√© au panier !",message:`${d.title.trim()} a bien √©t√© ajout√©.`,variant:"success"}}));else throw new Error("Produit introuvable dans l'index de recherche.")}catch(r){console.error("Erreur lors de l'ajout au panier:",r),Z.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"Erreur",message:r.message||"Impossible d'ajouter ce produit au panier.",variant:"error"}}))}finally{n.disabled=!1}}),n.dataset.listenerAttached="true")})}function pt(){$e(),window.addEventListener("cartUpdated",()=>{$e(),Ue()}),console.log("[Cart] Module global initialis√©.")}const gt=Object.freeze(Object.defineProperty({__proto__:null,addItem:xe,clearCart:ut,getCart:V,initAddToCartButton:mt,initCartPage:ft,initGlobalCart:pt,removeItem:Ie,updateItemQuantity:Fe},Symbol.toStringTag,{value:"Module"})),Je="zflex_analytics_queue_v1",yt=1e4,ht=50,vt=3,wt=150;let T=[],ge=!1,ye=null,Be=0;function We(){try{const e=document.getElementById("zflex-data");return!e||!e.textContent?{}:JSON.parse(e.textContent)}catch{return{}}}function bt(){try{const e=localStorage.getItem(Je);e&&(T=JSON.parse(e))}catch(e){console.warn("[Analytics] Load queue failed.",e),T=[]}}function Le(){try{localStorage.setItem(Je,JSON.stringify(T))}catch(e){console.warn("[Analytics] Persist queue failed.",e)}}function Et(e,t={}){const n=We()||{},r=document.querySelector("main");return{type:e,payload:t,storeId:n.storeId||null,context:{pageType:r?.dataset.pageType||null,title:document.title,url:window.location.href},ts:new Date().toISOString(),version:n.zflex_version||null}}function O(e,t={}){if(!e)return;const n=Et(e,t);T.push(n),Le(),console.log(`[Analytics] Event Queued: ${e}`,t)}async function Ge(e,t=1){if(!e||e.length===0)return{ok:!0};try{const n=e[0].storeId;return n?(await dt(n,e),{ok:!0}):{ok:!1,error:"Missing storeId"}}catch(n){return t<vt?(await new Promise(r=>setTimeout(r,1e3*t)),Ge(e,t+1)):{ok:!1,error:String(n)}}}async function ve(){if(!(ge||T.length===0)){ge=!0;try{const e=T.slice(0,ht),t=await Ge(e);t&&t.ok&&(T.splice(0,e.length),Le())}finally{ge=!1}}}function Ct(){ye&&clearInterval(ye),ye=setInterval(ve,yt),document.addEventListener("visibilitychange",()=>document.visibilityState==="hidden"&&ve()),window.addEventListener("beforeunload",()=>{if(T.length!==0)try{const e=We(),t=e.apiEndpoints?.trackEvent;navigator.sendBeacon&&t&&(navigator.sendBeacon(t,JSON.stringify({storeId:e.storeId,events:T})),T=[],Le())}catch(e){console.warn("[Analytics] Beacon failed.",e)}})}function St(){const e={"stacy:message_sent":t=>O("send_stacy_message",{length:t.message.length}),"cart:item_added":t=>O("add_to_cart",t.item),"cart:item_removed":t=>O("remove_from_cart",t.item),"cart:cleared":()=>O("clear_cart"),"checkout:purchase_success":t=>O("purchase",t.order)};for(const[t,n]of Object.entries(e))Z.addEventListener(t,r=>n(r.detail))}function xt(e){const t=e.getAttribute("data-analytics-type")||"",n=e.getAttribute("data-analytics-payload");let r={};if(n)try{r=JSON.parse(n)}catch(o){console.warn("[Analytics] √âchec parsing payload, attribut brut:",{payloadAttr:n,error:o})}return{type:t,payload:r}}function It(){document.addEventListener("click",e=>{const t=Date.now();if(t-Be<wt){e.stopImmediatePropagation();return}Be=t;const r=e.target.closest("[data-analytics-type]");if(!r)return;const{type:o,payload:a}=xt(r);o&&O(o,a)},!0)}function Lt(){bt(),Ct(),It(),St(),console.log("[Analytics] Module V3.2 (The Final Cut) initialis√©.")}function fe({path:e,title:t,extra:n={}}={}){O("pageview",{url:e||window.location.href,title:t||document.title,...n})}function Ke(e,t={}){O(e,t)}window.zflexAnalytics={track:Ke,trackPageview:fe,flush:ve,getQueue:()=>T};const kt=Object.freeze(Object.defineProperty({__proto__:null,initAnalytics:Lt,track:Ke,trackPageview:fe},Symbol.toStringTag,{value:"Module"}));let we=!1;function Ye(){Qe(),window.addEventListener("popstate",()=>ke());try{fe()}catch(e){console.warn("[Router] Le tracking de la page initiale a √©chou√©:",e)}console.log("[Router] Initialis√© en mode GATEKEEPER.")}function be(e){if(we)return;const n=e.target.closest("a.zflex-link");if(!n||n.target==="_blank")return;const r=new URL(n.href);if(r.hash&&r.pathname===window.location.pathname){e.preventDefault();const a=document.querySelector(r.hash);a&&a.scrollIntoView({behavior:"smooth",block:"start"});return}if(r.origin!==window.location.origin)return;e.preventDefault(),e.preventDefault();const o=r.pathname+r.search+r.hash;Xe(o)}function Qe(){document.body.addEventListener("touchstart",()=>{we=!1},{passive:!0}),document.body.addEventListener("touchmove",()=>{we=!0},{passive:!0}),document.body.addEventListener("click",be),document.body.addEventListener("touchend",be)}function Xe(e){e!==window.location.pathname&&(history.pushState({},"",e),ke())}async function ke(){const e=window.location.pathname;console.log(`[Router] Navigation d√©tect√©e vers : ${e}`);const t=e==="/"||e===""?"/content/home.html":`/content${e.replace(/\/$/,"")}.html`,n=document.getElementById("app-content"),r=document.getElementById("router-loader");if(!n){console.error("ERREUR CRITIQUE: Conteneur #app-content introuvable.");return}r&&r.classList.remove("hidden"),n.style.opacity="0.5",n.style.transition="opacity 0.3s ease-in-out";try{const o=await fetch(t);if(!o.ok){if(o.status===404){const m=await(await fetch("/content/404.html")).text();Ee(m,"404 - Page non trouv√©e");return}throw new Error(`Erreur serveur: ${o.statusText}`)}const a=await o.text();Ee(a)}catch(o){const a=o instanceof Error?o.message:String(o);console.error("Erreur de routage critique:",o),n.innerHTML=`
      <div class="text-center py-20">
        <h1 class="text-2xl font-bold">Erreur de chargement</h1>
        <p class="text-gray-600 mt-2">${a}</p>
        <button onclick="window.location.reload()" class="mt-4 bg-primary text-white font-bold py-2 px-4 rounded">Recharger la page</button>
      </div>
    `}finally{if(r&&r.classList.add("hidden"),document.body.contains(n)&&(n.style.opacity="1"),window.location.hash){const o=window.location.hash;setTimeout(()=>{const a=document.querySelector(o);a&&a.scrollIntoView({behavior:"smooth",block:"start"})},100)}else window.scrollTo(0,0)}}function Ee(e,t=null){const n=document.getElementById("app-content"),r=document.getElementById("zflex-data"),d=new DOMParser().parseFromString(e,"text/html").querySelector("main");if(d&&r&&n){const m=d.querySelector(".zflex-fragment-data");m&&(r.textContent=m.textContent,m.remove()),document.title=t||d.dataset.pageTitle||document.title,n.innerHTML="",n.appendChild(d),window.dispatchEvent(new CustomEvent("zflex:page-loaded",{detail:{path:window.location.pathname}}));try{fe()}catch(p){console.warn("[Router] Le tracking de la nouvelle page a √©chou√©:",p)}}else console.error("Erreur critique: <main> ou #zflex-data manquant.")}const Tt=Object.freeze(Object.defineProperty({__proto__:null,bindEventListeners:Qe,handleLinkClick:be,handleLocationChange:ke,initRouter:Ye,navigateTo:Xe,updatePageContent:Ee},Symbol.toStringTag,{value:"Module"}));let _=!1,z=[],Ce=null,re=null;const Ze=1440*60*1e3,J=e=>`stacy_conv_${e}`,me=e=>`stacy_history_${e}`,Pt=new Set(["searchProducts","manageCart","getContextDelta","redirectToVerifyPage"]);function ee(){try{const t=document.getElementById("zflex-data")?.textContent;return t?JSON.parse(t):{}}catch(e){return console.error("[Stacy] Erreur de parsing des donn√©es de la page",e),{}}}async function et(){if(re)return re;try{const e=await fetch("/api/search-index.json");if(!e.ok)throw new Error(`R√©ponse r√©seau non OK: ${e.statusText}`);return re=await e.json(),re||[]}catch(e){return console.error("[Stacy] Impossible de charger l'index de recherche:",e),[]}}function M(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function _t(e){try{const t=String(e).trim();if(/^(https?:|mailto:)/i.test(t))return t}catch{}return"#"}function Te(e){let t=M(e);return t=t.replace(/```([\s\S]*?)```/g,(n,r)=>`<pre class="stacy-code"><code>${M(r)}</code></pre>`),t=t.replace(/`([^`]+)`/g,(n,r)=>`<code class="stacy-inline-code">${M(r)}</code>`),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(n,r,o)=>`<a href="${_t(o)}" target="_blank" rel="noopener noreferrer" class="zflex-link">${M(r)}</a>`),t=t.replace(/\*\*([^*]+)\*\*/g,(n,r)=>`<strong>${M(r)}</strong>`),t=t.replace(/\*([^*]+)\*/g,(n,r)=>`<em>${M(r)}</em>`),t=t.replace(/\r?\n/g,"<br>"),t}function Pe(e){try{let t=function(d){const m=Array.from(d.childNodes);for(const p of m)if(p.nodeType===Node.ELEMENT_NODE){const v=p;if(a.has(v.tagName)){if(v.tagName==="A"){const b=v.getAttribute("href")||"";/^(https?:|mailto:)/i.test(b.trim())?(v.setAttribute("target","_blank"),v.setAttribute("rel","noopener noreferrer")):v.removeAttribute("href")}else{const b=Array.from(v.attributes);for(const E of b)v.removeAttribute(E.name)}t(v)}else{const b=document.createDocumentFragment();for(;v.firstChild;)b.appendChild(v.firstChild);d.replaceChild(b,v),t(d);continue}}else p.nodeType!==Node.TEXT_NODE&&d.removeChild(p)};const o=new DOMParser().parseFromString(`<div>${e}</div>`,"text/html").body.firstChild;if(!o)return"";const a=new Set(["A","UL","OL","LI","STRONG","EM","CODE","PRE","BR","P"]);return t(o),o.innerHTML}catch(t){return console.warn("[Stacy] sanitizeHtml failed, falling back to escaped text",t),M(e)}}function pe(e,t,n={rawHtml:!1}){const r=document.querySelector("[data-stacy-messages]");if(!r)return;const o=document.createElement("div");o.className="flex flex-col p-1 my-1 max-w-[85%] text-sm break-words";const a=document.createElement("div");a.className="p-2 rounded-lg";const d=document.createElement("div");d.className="text-xs mb-1 truncate";const m=typeof e.text=="string"?e.text:JSON.stringify(e.text??"");t==="user"?(o.style.alignSelf="flex-end",a.classList.add("bg-primary/20","self-end"),d.textContent="Vous",d.style.textAlign="right",a.textContent=m):(o.style.alignSelf="flex-start",d.textContent="Stacy",d.style.color="var(--text-muted-color)",a.classList.add("self-start"),a.style.backgroundColor="var(--chat-response-bg-color)",a.style.color="var(--text-color)",n.rawHtml?a.innerHTML=Pe(m):a.innerHTML=Te(m)),o.appendChild(d),o.appendChild(a),r.appendChild(o),r.scrollTop=r.scrollHeight}function tt(){const e=document.querySelector("[data-stacy-messages]");e&&(e.innerHTML="",z.forEach(t=>pe(t,t.role,{rawHtml:!0})))}async function At(){const e=ee().storeId;if(!e)return;const t=localStorage.getItem(J(e)),n=t?JSON.parse(t):null;if(n&&Date.now()-n.createdAt<Ze){const r=localStorage.getItem(me(n.convId));z=r?JSON.parse(r):[],tt()}else await rt(e)}function U(e){localStorage.setItem(me(e),JSON.stringify(z))}function ae(e,t){const n={role:t,text:e,ts:Date.now()};z.push(n),pe(n,t,{rawHtml:!0})}function qt(){const e=document.querySelector("[data-stacy-messages]");if(!e)return null;const t=document.createElement("div");return t.className="p-2 my-1 rounded-lg max-w-[60%] self-start text-sm break-words stacy-typing",t.innerHTML='<div class="typing-indicator"><span></span><span></span><span></span></div>',e.appendChild(t),e.scrollTop=e.scrollHeight,t}function $t(e,t={rawHtml:!1}){const n=document.querySelector("[data-stacy-messages]");if(!n)return null;const r=document.createElement("div");r.className="flex flex-col p-1 my-1 max-w-[85%] text-sm break-words model-message-wrapper";const o=document.createElement("div");o.className="text-xs mb-1 truncate",o.textContent="Stacy",o.style.color="var(--muted-text-color)";const a=document.createElement("div");a.className="p-2 rounded-lg self-start model-message-bubble";const d=e;t.rawHtml?a.innerHTML=Pe(d):a.innerHTML=Te(d);const m=document.createElement("div");return m.className="stacy-partial-loader",m.style.marginTop="6px",m.innerHTML='<div class="typing-indicator"><span></span><span></span><span></span></div>',m.style.display="none",r.appendChild(o),r.appendChild(a),r.appendChild(m),n.appendChild(r),n.scrollTop=n.scrollHeight,{wrapper:r,bubble:a,loader:m}}function Me(e){!e||!e.loader||(e.loader.style.display="",e.wrapper.scrollIntoView({behavior:"smooth",block:"end"}))}function F(e){!e||!e.loader||(e.loader.style.display="none")}function H(e,t,n={rawHtml:!1}){!e||!e.bubble||(n.rawHtml?e.bubble.innerHTML=Pe(t):e.bubble.innerHTML=Te(t),F(e))}async function De(e,t=12e3){let n;return Promise.race([e,new Promise((r,o)=>n=setTimeout(()=>o(new Error("timeout")),t))]).finally(()=>clearTimeout(n))}async function nt(e){const t=J(e);try{const n=localStorage.getItem(t);if(n){const o=JSON.parse(n);if(Date.now()-(o.createdAt||0)<=Ze)return o.convId}const r=await Re(e);if(!r?.convId)throw new Error("createConversation n'a pas retourn√© de convId");return localStorage.setItem(t,JSON.stringify({convId:r.convId,createdAt:Date.now()})),localStorage.removeItem(me(r.convId)),r.convId}catch(n){throw console.error("[Stacy] Erreur getOrCreateConvId",n),n}}async function rt(e){try{const t=localStorage.getItem(J(e)),n=t?JSON.parse(t):null;n&&localStorage.removeItem(me(n.convId)),localStorage.removeItem(J(e)),z=[],tt();const r=await Re(e);if(r?.convId){localStorage.setItem(J(e),JSON.stringify({convId:r.convId,createdAt:Date.now()}));const o=r.greeting||"Salut ! C'est Stacy, ton assistante shopping. Pr√™t(e) √† trouver des p√©pites ? ‚ú®";ae(o,"model"),U(r.convId)}}catch(t){console.error("[Stacy] resetConversation error",t),pe({text:"Impossible de r√©initialiser la conversation."},"model")}}async function Bt(e){e.preventDefault();const n=e.target.querySelector("[data-stacy-input]");if(!n)return;const r=n.value.trim();if(!r)return;ae(r,"user"),n.value="";const o=ee().storeId;if(o){const a=await nt(o);U(a)}await Mt(r)}async function Mt(e){const t=document.querySelector("[data-stacy-input]");t&&(t.disabled=!0);const n=qt();try{const r=ee().storeId;if(!r)throw new Error("storeId introuvable");const o=await nt(r),a=await ct(r,o,e);if(n&&n.remove(),a.newConvId&&localStorage.setItem(J(r),JSON.stringify({convId:a.newConvId,createdAt:Date.now()})),a.functionCall){const p=$t("Un instant, je r√©fl√©chis... ü§î",{rawHtml:!1});if(Me(p),a.needsUserInput){F(p);const b=a.answer||"J'ai besoin d'une information suppl√©mentaire.";if(H(p,b,{rawHtml:!1}),p&&p.wrapper){const E=p.wrapper,C=document.createElement("input");C.type="text",C.placeholder="Entrez le num√©ro de commande...",C.className="stacy-inline-input";const x=document.createElement("button");x.textContent="Envoyer",x.className="stacy-inline-btn";const I=document.createElement("div");I.style.marginTop="8px",I.appendChild(C),I.appendChild(x),E.appendChild(I),C.focus();const N=async()=>{const q=C.value.trim();if(q){I.remove(),Me(p);try{const $=a.functionCall?.name||"unknown",L=(await qe(r,o,{name:$,result:{orderId:q}}))?.answer??"D√©sol√©, erreur lors de la finalisation.";H(p,L,{rawHtml:!0}),z.push({role:"model",text:L}),U(o)}catch{F(p),H(p,"Erreur lors de l'envoi de l'information. R√©essaie.",{rawHtml:!1})}}};x.addEventListener("click",N),C.addEventListener("keydown",q=>{q.key==="Enter"&&N()})}return}const v=a.functionCall.name||"unknown";if(Pt.has(v))try{const b=await De(Dt(a.functionCall),12e3),E=b.result??b,x=(await De(qe(r,o,{name:v,result:E}),2e4))?.answer??"D√©sol√©, erreur lors de la finalisation.";x.includes("__tool_result")?p?.wrapper.remove():(H(p,x,{rawHtml:!0}),z.push({role:"model",text:x})),U(o);return}catch{F(p),H(p,"Impossible d'ex√©cuter l'action c√¥t√© client.",{rawHtml:!1});return}if(a.answer){F(p),H(p,a.answer,{rawHtml:!0}),z.push({role:"model",text:a.answer}),U(o);return}F(p),H(p,"Action en attente...",{rawHtml:!1});return}const d=a?.answer??"D√©sol√©, une erreur est survenue.";ae(d,"model"),U(o)}catch(r){n&&n.remove(),console.error("[Stacy] Erreur processStacyRequest",r),ae("Oups, quelque chose s'est mal pass√©. Veuillez r√©essayer.","model")}finally{t&&(t.disabled=!1,_&&t.focus())}}async function Dt(e){const t=e.name||e.functionName||e.fn||"unknown",n=e.args||e.arguments||e.params||{};switch(t){case"searchProducts":{const r=String(n.keywords||n.q||""),o=await Ot(r);return{success:!!o.success,action:"searchProducts",result:o}}case"manageCart":{const r=await zt(n);return{success:!!r.success,action:"manageCart",result:r}}case"redirectToVerifyPage":{const r=await Ht();return{success:!!r.success,action:"redirectToVerifyPage",result:r}}case"getContextDelta":return{success:!0,action:"getContextDelta",result:Nt()};default:return console.warn(`[Stacy] functionCall non g√©r√© c√¥t√© client: ${t}`),{success:!1,action:String(t),result:{displayText:`Action demand√©e inconnue c√¥t√© client: ${String(t)}`,reason:"unknown"}}}}async function Ot(e){const t=await et(),n=String(e||"").toLowerCase().split(" ").filter(o=>o),r=t.filter(o=>n.every(a=>o.title.toLowerCase().includes(a)));return r.length>0?{success:!0,products:r.slice(0,3).map(a=>({id:a.id,title:a.title,price:a.price,shortDescription:a.shortDescription,url:a.url})),displayText:`J'ai trouv√© ${r.length} produit(s).`}:{success:!1,displayText:`D√©sol√©, je n'ai trouv√© aucun produit pour "${M(String(e))}".`}}async function zt(e){const t=e.action,n=e.productId,r=e.quantity||1;switch(t){case"add":{if(!n)return{success:!1,displayText:"Je ne sais pas quel produit ajouter."};const a=(await et()).find(d=>d.id===n);return a?(xe(a,r),{success:!0,displayText:`J'ai ajout√© ${r}x "${a.title}" √† votre panier.`}):{success:!1,displayText:`Je n'ai pas trouv√© le produit avec l'ID ${n}.`}}case"remove":return n?(Ie(n),{success:!0,displayText:"L'article a √©t√© retir√© de votre panier."}):{success:!1,displayText:"Je ne sais pas quel produit retirer."};case"list":default:{const o=V();return!o||o.length===0?{success:!0,cart:[],displayText:"Votre panier est actuellement vide."}:{success:!0,cart:o,displayText:`Votre panier contient ${o.length} article(s).`}}}}function Nt(){return{pageType:document.querySelector("#app-content main")?.dataset.pageType||"unknown",pageTitle:document.title,url:window.location.href,productContext:ee().product||null}}async function Ht(){if(Ce)try{return Ce.navigateTo("/verify/"),Se(),{success:!0,displayText:"[Action Syst√®me] Redirection vers /verify/ effectu√©e."}}catch(e){return console.warn("[Stacy] Router navigation failed",e),{success:!1,displayText:"[Action Syst√®me] Routeur non disponible."}}else return{success:!1,displayText:"[Action Syst√®me] Routeur non disponible."}}function Se(){const e=document.querySelector("[data-stacy-window]"),t=document.querySelector("[data-stacy-fab-button]");if(!e||!t)return;_=!_,e.classList.toggle("is-open",_),e.classList.toggle("hidden",!_),t.setAttribute("aria-expanded",String(_));const n=t.querySelector('[data-stacy-icon="chat"]'),r=t.querySelector('[data-stacy-icon="close"]');if(n&&r&&(n.style.opacity=_?"0":"1",r.style.opacity=_?"1":"0"),_){At();const o=document.querySelector("[data-stacy-input]");o&&setTimeout(()=>o.focus(),50)}}function Rt(){const e=document.querySelector("[data-stacy-fab-button]");e&&e.addEventListener("click",Se);const t=document.querySelector("[data-stacy-form]");if(t){t.addEventListener("submit",Bt);const r=t.querySelector("[data-stacy-input]");r&&r.addEventListener("keydown",o=>{const a=o;a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),t.requestSubmit())})}document.addEventListener("keydown",r=>{r.key==="Escape"&&_&&Se()});const n=document.querySelector("[data-stacy-delete]");n&&n.addEventListener("click",async()=>{try{const r=ee().storeId;if(!r)throw new Error("storeId introuvable");await rt(r)}catch(r){console.error("[Stacy] delete conv failed",r),pe({text:"Impossible de supprimer la conversation."},"model")}})}function jt(e){document.querySelector("[data-stacy-fab]")&&(Ce=e,Rt(),console.log("[Stacy] Module V7.5 (Brain Upgrade) initialis√©."))}const Vt=Object.freeze(Object.defineProperty({__proto__:null,initStacy:jt},Symbol.toStringTag,{value:"Module"}));let K;function Ft(){const e=document.getElementById("install-app-btn");e&&(console.log("[PWA] L'application est maintenant installable."),e.disabled=!1,e.classList.remove("opacity-50","cursor-not-allowed"),e.addEventListener("click",Ut,{once:!0}))}function ot(){const e=document.getElementById("install-app-btn"),t=document.getElementById("app-installed-message");e&&t&&(e.classList.add("hidden"),t.classList.remove("hidden"))}async function Ut(){if(!K)return;K.prompt();const{outcome:e}=await K.userChoice;e==="accepted"?(console.log("[PWA] L'utilisateur a accept√© l'installation."),ot()):console.log("[PWA] L'utilisateur a refus√© l'installation."),K=null}function Jt(){window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone?(console.log("[PWA] D√©tect√© comme une application install√©e."),ot()):window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),K=e,Ft()}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(()=>console.log("[PWA] Service Worker OK.")).catch(e=>console.error("[PWA] Service Worker KO:",e))}const Wt=Object.freeze(Object.defineProperty({__proto__:null,initPwa:Jt},Symbol.toStringTag,{value:"Module"}));let j=null,he=null,se=null,Y=null,Q=null,R=null,ie=null,ce=null,le=null,de=null,X=null;function _e(){j&&(j.classList.add("hidden"),de=null,X=null)}function Gt(){if(typeof de=="function")try{de()}catch(e){console.error("[Dialog] Erreur dans onConfirm:",e)}_e()}function Kt(){if(typeof X=="function")try{X&&X()}catch(e){console.error("[Dialog] Erreur dans onCancel:",e)}_e()}function D(e,t,n={}){if(!j){alert(`${e}

${t}`),n.onConfirm&&n.onConfirm();return}ie?.classList.add("hidden"),ce?.classList.add("hidden"),le?.classList.add("hidden"),n.variant==="success"?ie?.classList.remove("hidden"):n.variant==="error"?ce?.classList.remove("hidden"):le?.classList.remove("hidden"),se&&(se.textContent=e),Y&&(n.messageHtml?Y.innerHTML=n.messageHtml:Y.textContent=t||""),Q&&(Q.textContent=n.confirmText||"OK"),R&&(n.cancelText?(R.classList.remove("hidden"),R.textContent=n.cancelText):R.classList.add("hidden")),de=typeof n.onConfirm=="function"?n.onConfirm:null,X=typeof n.onCancel=="function"?n.onCancel:null,j.classList.remove("hidden")}function Yt(){if(j=document.getElementById("zflex-dialog"),!!j){if(he=document.getElementById("dialog-overlay"),se=document.getElementById("dialog-title"),Y=document.getElementById("dialog-message"),Q=document.getElementById("dialog-confirm-btn"),R=document.getElementById("dialog-cancel-btn"),ie=document.getElementById("dialog-icon-success"),ce=document.getElementById("dialog-icon-error"),le=document.getElementById("dialog-icon-info"),!he||!se||!Y||!Q||!ie||!ce||!le||!R){console.error("[Dialog] Un ou plusieurs √©l√©ments internes du dialog sont manquants. V√©rifie les IDs."),j=null;return}he.addEventListener("click",_e),Q.addEventListener("click",Gt),R.addEventListener("click",Kt),Z.addEventListener("dialog:show",e=>{const t=e.detail||{},{title:n,message:r,variant:o}=t,a={variant:o,onConfirm:t.onConfirm,onCancel:t.onCancel,confirmText:t.confirmText,cancelText:t.cancelText,messageHtml:t.messageHtml};D(n,r,a)}),console.log("[Dialog] Module initialis√© et pr√™t (callbacks & HTML).")}}const Qt=Object.freeze(Object.defineProperty({__proto__:null,initDialog:Yt,showDialog:D},Symbol.toStringTag,{value:"Module"}));function oe(){const e=document.getElementById("search-modal"),t=document.getElementById("search-input");if(!e||!t)return;!e.classList.contains("hidden")?(e.classList.add("opacity-0"),setTimeout(()=>e.classList.add("hidden"),300)):(e.classList.remove("hidden"),requestAnimationFrame(()=>e.classList.remove("opacity-0")),t.focus())}function Xt(e){const t=document.getElementById("search-results");if(t){if(e.length===0){t.innerHTML='<p class="text-center p-4" style="color: var(--text-muted-color);">Aucun r√©sultat trouv√©. Veuillez consulter notre assistante Stacy pour plus de recommandations.</p>';return}t.innerHTML=e.map(n=>{const r=n.coverImage||"",o=typeof n.price.amount=="number"?n.price.amount:0,a=n.price.currency||"EUR";return`
    <a href="${n.url||"#"}" class="flex items-center p-3 hover:bg-gray-100/50 transition-colors zflex-link border-b" style="border-color: var(--card-border-color);">
      <img src="${r}" alt="${n.title}" class="w-12 h-12 object-cover rounded-md mr-4 flex-shrink-0">
      <div class="flex-grow">
        <h4 class="font-semibold" style="color: var(--text-color);">${n.title}</h4>
        <p class="text-sm font-bold" style="color: var(--primary-color);">${o.toFixed(2)} ${a}</p>
      </div>
    </a>
  `}).join("")}}async function Zt(){const e=document.getElementById("search-toggle-btn"),t=document.getElementById("search-modal"),n=document.getElementById("search-modal-overlay"),r=document.getElementById("search-input"),o=document.getElementById("search-results");if(!e||!t||!r||!n||!o)return;const a=await je();e.addEventListener("click",oe),n.addEventListener("click",oe),r.addEventListener("input",()=>{const d=r.value.trim().toLowerCase();if(d.length<2){o.innerHTML='<p class="text-center p-4" style="color: var(--text-muted-color);">Tapez au moins 2 caract√®res pour rechercher.</p>';return}const m=a.filter(p=>p.title.toLowerCase().includes(d)).slice(0,5);Xt(m)}),document.addEventListener("keydown",d=>{d.key==="Escape"&&!t.classList.contains("hidden")&&oe()}),o.addEventListener("click",d=>{d.target.closest("a")&&oe()})}function en(){const e=document.getElementById("site-header");if(!e||e.dataset.variant!=="transparent")return;const t=()=>{window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")};window.addEventListener("scroll",t,{passive:!0}),t()}function tn(){const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu");!e||!t||e.addEventListener("click",()=>{t.classList.toggle("hidden")})}function nn(){const e=document.getElementById("settings-toggle-btn"),t=document.getElementById("settings-menu");!e||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.toggle("hidden")}),document.addEventListener("click",()=>{t.classList.add("hidden")}))}function rn(){en(),tn(),nn(),console.log("[GlobalUI] Module initialis√©.")}function on(){try{const e=document.getElementById("zflex-data");return e?JSON.parse(e.textContent||"{}"):{}}catch(e){return console.error("[Newsletter] getPageData parse error",e),{}}}function an(){const e=document.getElementById("newsletter-form"),n=on().storeId;if(!e){document.querySelector(".newsletter-section")&&console.warn("Newsletter form not found. Skipping initialization.");return}e.addEventListener("submit",async r=>{r.preventDefault();const o=e.querySelector('input[type="email"]');if(!o){console.error("Email input not found in newsletter form."),D("Erreur","Impossible de trouver le champ email.",{variant:"error"});return}const a=o.value.trim();if(!a){D("Attention","Veuillez entrer une adresse email valide.",{variant:"info"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)){D("Attention","Le format de l'adresse email est invalide.",{variant:"info"});return}const d=e.querySelector('button[type="submit"]');d&&(d.disabled=!0,d.textContent="Envoi..."),o.disabled=!0;try{const m=await lt(a,n);if(m&&m.success)D("Merci !",`Vous √™tes maintenant inscrit avec l'adresse : ${a}`,{variant:"success"}),e.reset();else{const p=m?.message||"Une erreur est survenue lors de l'inscription. Veuillez r√©essayer.";D("Erreur",p,{variant:"error"})}}catch(m){console.error("Newsletter subscription error:",m),D("Erreur","Une erreur inattendue est survenue. Veuillez r√©essayer plus tard.",{variant:"error"})}finally{d&&(d.disabled=!1,d.textContent="S'abonner"),o.disabled=!1}})}function sn(){console.log("üíé [Crystal Preview] Engine v4.0 Engaged."),te();let e=[],t={},n=[],r={},o=!1;function a(i={}){const s=document.documentElement;Object.entries(i).forEach(([c,g])=>{if(g==null)return;const l=String(g);if(c.startsWith("--"))s.style.setProperty(c,l);else switch(c.replace("palette.","").replace("computedPalette.","").replace("computed.","")){case"background":s.style.setProperty("--bg-color",l);break;case"text":s.style.setProperty("--text-color",l);break;case"primary":s.style.setProperty("--primary-color",l);break;case"secondary":s.style.setProperty("--secondary-color",l);break;case"accent":s.style.setProperty("--accent-color",l);break;case"cardBackground":s.style.setProperty("--card-bg-color",l);break;case"textMuted":s.style.setProperty("--text-muted-color",l);break;case"cardBorder":s.style.setProperty("--card-border-color",l);break;case"inputBackground":s.style.setProperty("--input-bg-color",l);break;case"chatResponseBackground":s.style.setProperty("--chat-response-bg-color",l);break;case"primary600":s.style.setProperty("--primary-600",l);break;case"primary700":s.style.setProperty("--primary-700",l);break;case"secondary600":s.style.setProperty("--secondary-600",l);break;default:s.style.setProperty(`--${c.replace(/\./g,"-")}`,l)}})}function d(i){i&&a({...i.palette,...i.computed})}function m(i,s,c,g=!1){const l=i.tagName.toUpperCase(),y=s.toLowerCase().includes("image")||s.toLowerCase().includes("bg"),w=i.hasAttribute("data-zflex-bg-hero")||i.hasAttribute("data-zflex-bg"),u=typeof c=="string"&&c.startsWith("data:image")&&c.length>5e5;if(l==="IMG")i.src=c;else if(l==="I"||i.classList.contains("fa")||s.includes(".icon")||i.querySelector("i")){const h=l==="I"?i:i.querySelector("i");if(h){let f=c;f.includes("fa-")||(f=`fa-${f}`),f.match(/fa[sbr]/)||(f=`fas ${f}`),h.className=`${f} ${h.className.split(" ").filter(S=>!S.match(/fa[sbr]/)&&!S.startsWith("fa-")).join(" ")}`}}else if(w||y||i.style.backgroundImage||i.hasAttribute("data-zflex-bg-hero")){const h=c&&c!=="undefined"?`url('${c}')`:"none";if(i.hasAttribute("data-zflex-bg-hero")||i.style.getPropertyValue("--hero-img")!=="")i.style.setProperty("--hero-img",h),(u||!i.style.backgroundImage.includes("var("))&&(i.style.backgroundImage=h);else if(i.style.getPropertyValue("--zflex-img-url")!=="")i.style.setProperty("--zflex-img-url",h),(u||w&&!i.style.backgroundImage.includes("var("))&&(i.style.backgroundImage=h);else{const f=getComputedStyle(i).backgroundImage;f&&f!=="none"&&f.includes("url(")?i.style.backgroundImage=f.replace(/url\(['"]?.*?['"]?\)/,h):i.style.backgroundImage=h}}else i.innerHTML=c;o||(u?setTimeout(()=>L(i,!0),400):L(i,!g))}function p(i,s=!1){const{id:c,value:g}=i;if(c.startsWith("palette.")||c.startsWith("typography.")||c.includes("Palette.")){const y={};if(y[c]=g,c.includes("Font")){const w=c.includes("heading")?"--heading-font":"--body-font";document.documentElement.style.setProperty(w,g)}a(y);return}if(c==="promo.endDate"){const y=document.querySelector("[data-promo-end]");y&&y.setAttribute("data-promo-end",g)}document.querySelectorAll(`[data-zflex-id="${c}"]`).forEach(y=>{m(y,c,g,s)})}function v(i){const{id:s,product:c}=i;s==="featuredProduct.productId"&&(p({id:"featuredProduct.title",value:c.title}),p({id:"featuredProduct.description",value:c.shortDescription||c.description||""}),p({id:"featuredProduct.image",value:c.coverImage||c.images&&c.images.main||c.image}),p({id:"featuredProduct.price",value:`${c.price?.amount||c.price||"0.00"} ‚Ç¨`})),p({id:s,value:c.id})}function b(i){if(!e||e.length===0)return[];const s=String(i).toLowerCase();return e.filter(c=>String(c.categoryId||"").toLowerCase()===s?!0:(c.categories||(c.category?[c.category]:[])).some(y=>{const w=String(typeof y=="string"?y:y.label||y.name||y.title||"").toLowerCase(),u=String(typeof y=="object"&&(y.id||y._id)||"").toLowerCase();return w===s||u===s}))}async function E(i){const{id:s,products:c,category:g}=i,l=document.querySelector('template[data-zflex-template="product.card"]');if(!l)return;if(s==="productsByCategory"||s==="productsByCategory.style"||s==="productsByCategory.productIds"){(!n||n.length===0)&&(!e||e.length===0)&&console.warn("üíé [Crystal Preview] Warning: Attempting to rebuild Category List/Switcher but caches are empty. Check initData.");const u=document.querySelector(".category-switcher-container"),h=document.querySelector('[data-zflex-section="productsByCategory"] .space-y-24'),f=document.querySelector('[data-zflex-variant-container="productsByCategory"]');u&&n.length>0?C(u,l):h&&n.length>0&&x(h,l),f&&!o&&L(f,!0);return}const w=document.querySelector(`[data-zflex-id="${s}"] .grid`)||document.querySelector(`[data-zflex-section="${s.split(".")[0]}"] .grid`);if(w){let u=c||(g?b(g):[]);u.length===0&&!c&&!g&&s.includes("featuredProducts")&&(u=e.slice(0,4)),I(w,u,l,s.includes("featuredProducts")?4:8)}}function C(i,s){const c=i.querySelector(".flex.items-center.space-x-4"),g=i.querySelector(".category-grids-wrapper");if(!c||!g)return;c.innerHTML="",g.innerHTML="";const l=getComputedStyle(document.documentElement).getPropertyValue("--primary-color").trim()||"#000";n.forEach((y,w)=>{const u=String(y.id),h=b(u);if(h.length===0)return;const f=document.createElement("button");f.className=`category-tab-btn flex-shrink-0 px-6 py-2 rounded-full font-semibold transition-all duration-300 ${w===0?"active-tab bg-primary text-white shadow-lg":"hover:bg-black/5 opacity-60"}`,f.setAttribute("data-category-target",u),f.innerText=y.label||"Collection",w===0&&(f.style.backgroundColor=l,f.style.color="white",f.style.opacity="1"),f.onclick=()=>{i.querySelectorAll(".category-tab-btn").forEach(P=>{const k=P;k.classList.remove("active-tab","bg-primary","text-white","shadow-lg"),k.style.backgroundColor="",k.style.color="",k.style.opacity="0.6"}),f.classList.add("active-tab"),f.style.backgroundColor=l,f.style.color="white",f.style.opacity="1",i.querySelectorAll(".category-grid-content").forEach(P=>{const k=P;k.getAttribute("data-category-content")===u?(k.style.display="grid",setTimeout(()=>k.classList.remove("hidden","opacity-0","translate-y-4"),10)):(k.classList.add("hidden","opacity-0","translate-y-4"),k.style.display="none")})},c.appendChild(f);const S=document.createElement("div");S.className=`category-grid-content transition-all duration-500 ${w===0?"grid":"hidden opacity-0 translate-y-4"} grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8`,S.style.display=w===0?"grid":"none",S.setAttribute("data-category-content",u),g.appendChild(S),I(S,h,s,8)})}function x(i,s){i.innerHTML="",n.forEach(c=>{const g=b(String(c.id));if(g.length===0)return;const l=document.createElement("div");l.className="category-section group py-12",l.innerHTML=`
            <div class="flex justify-between items-center border-b pb-4 mb-8 border-muted">
                <h3 class="text-2xl md:text-3xl font-bold border-l-4 pl-4" style="border-color: var(--primary-color)">${c.label}</h3>
                <a href="#" class="text-primary font-semibold hover:underline">Voir tout</a>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8"></div>
          `;const y=l.querySelector(".grid");I(y,g,s,8),i.appendChild(l)})}function I(i,s,c,g=8){const l=document.createDocumentFragment(),y=t?.currency||"‚Ç¨",w=(s||[]).slice(0,g);w.forEach(u=>{const h=c.content.cloneNode(!0),f=h.firstElementChild;if(f){const S=f.querySelector('[data-zflex-bind="image"]');S&&(S.src=u.coverImage||u.images&&u.images.main||u.image),f.querySelector('[data-zflex-bind="title"]')&&(f.querySelector('[data-zflex-bind="title"]').textContent=u.title),f.querySelectorAll('[data-zflex-bind="price"]').forEach(k=>k.textContent=`${u.price?.amount||u.price?.value||u.price||"0.00"} ${u.price?.currency||y}`),l.appendChild(h)}}),i.innerHTML=w.length===0?'<p class="text-center opacity-50 col-span-full py-8 italic font-medium">Cette collection est vide.</p>':"",w.length>0&&i.appendChild(l)}function N(i){const s=document.querySelector('main[data-page-type="home"]');s&&i.sections.forEach(c=>{const g=s.querySelector(`[data-zflex-section="${c.type}"]`);g&&s.appendChild(g)})}function q(i){const{id:s,variant:c,data:g}=i;if(s==="productCard"||s==="productCard.style"){const w=c||g&&g.style||"classic",u=document.querySelector(`template[data-zflex-variant="productCard.${w}"]`),h=document.querySelector('template[data-zflex-template="product.card"]');u&&h&&(h.innerHTML=u.innerHTML,E({id:"featuredProducts.productIds"}),E({id:"productsByCategory.style"}));return}const l=document.querySelector(`[data-zflex-variant-container="${s}"]`),y=document.querySelector(`template[data-zflex-variant="${s}.${c}"]`);if(l&&y){const u=y.content.cloneNode(!0).firstElementChild;if(u){B(u,g,s),l.innerHTML="",l.appendChild(u);const h=u.querySelector("[data-zflex-repeater]");if(h){const f=h.getAttribute("data-zflex-repeater"),S=g&&g.items||r[s]&&r[s].items||[];f&&S.length>0&&$({id:f,items:S})}(s==="productsByCategory"||s==="featuredProducts")&&E({id:`${s}.productIds`}),o||L(l,!0)}}}function $(i){const{id:s,items:c}=i,g=document.querySelector(`[data-zflex-repeater="${s}"]`),l=document.querySelector(`template[data-zflex-template="${s}"]`);!g||!l||(g.innerHTML="",c.forEach((y,w)=>{const h=l.content.cloneNode(!0).firstElementChild;h&&(s==="features.items"&&((w+1)%2!==0?(h.classList.add("md:flex-row"),h.classList.remove("md:flex-row-reverse")):(h.classList.add("md:flex-row-reverse"),h.classList.remove("md:flex-row"))),B(h,y,`${s}.${w}`),g.appendChild(h))}),o||L(g,!0))}function B(i,s,c){if(i.querySelectorAll("[data-zflex-bind]").forEach(l=>{const y=l.getAttribute("data-zflex-bind");if(!y)return;const w=s[y];l.setAttribute("data-zflex-id",`${c}.${y}`),w!==void 0&&m(l,y,w,!0)}),i.hasAttribute("data-zflex-bind")){const l=i.getAttribute("data-zflex-bind");l&&s[l]&&(i.setAttribute("data-zflex-id",`${c}.${l}`),m(i,l,s[l],!0))}}function L(i,s=!1){document.querySelectorAll(".zflex-highlight-pulse").forEach(c=>{c!==i&&c.classList.remove("zflex-highlight-pulse")}),i.classList.add("zflex-highlight-pulse"),s&&i.scrollIntoView({behavior:"smooth",block:"center"})}function te(){if(document.getElementById("zflex-preview-styles"))return;const i=document.createElement("style");i.id="zflex-preview-styles",i.textContent=`
      .zflex-highlight-pulse { 
        outline: 4px solid var(--primary-color, #3b82f6) !important; 
        outline-offset: -4px !important; 
        transition: outline 0.3s ease;
      }
      @keyframes zflex-glimmer {
        0% { opacity: 1; outline-color: var(--primary-color, #3b82f6); }
        50% { opacity: 0.8; outline-color: rgba(0,0,0,0); }
        100% { opacity: 1; outline-color: var(--primary-color, #3b82f6); }
      }
    `,document.head.appendChild(i)}window.addEventListener("message",i=>{const s=i.data;if(s.source==="zflex-admin")switch(s.action){case"initData":o=!0;const c=s.payload;console.log("üíé [Crystal Preview] initData received. Products:",c.products?.length,"Store:",Object.keys(c.store||{}).length),e=c.products||[],t=c.store||{};const g=new Map;(c.categories||[]).forEach(u=>{const h=String(u.id||u._id);h&&(u.label||u.name||u.title)&&g.set(h,u.label||u.name||u.title)});const l=new Set;e.forEach(u=>{u.categoryId&&l.add(String(u.categoryId)),(u.categories||(u.category?[u.category]:[])).forEach(f=>{const S=typeof f=="object"?f.id||f._id:f;if(S&&l.add(String(S)),typeof f=="object"&&!g.has(String(S))){const P=f.label||f.name||f.title;P&&g.set(String(S),P)}})}),n=Array.from(l).map(u=>{const h=String(u);let f=g.get(h);if(!f||f==="name"){const S=(c.categories||[]).find(P=>String(P.id||P._id)===h);S&&(f=S.label||S.name)}return{id:h,label:f||"Collection"}}).filter(u=>u.id!=="undefined"&&u.id!=="null"),E({id:"productsByCategory"}),setTimeout(()=>{o=!1,console.log("üíé [Crystal Preview] Silent Boot complete.")},800);break;case"updateProductData":v(s.payload);break;case"updateProductList":E(s.payload);break;case"updatePalette":d(s.payload);break;case"updateStyle":p({id:s.payload.property,value:s.payload.value});break;case"updateElement":p(s.payload);break;case"updateLayout":N(s.payload);break;case"updateVariant":const y=s.payload;r[y.id]=y.data,q(y);break;case"updateRepeater":$(s.payload);break;case"highlight":const w=document.querySelector(`[data-zflex-id="${s.payload.id}"]`);w&&!o&&L(w,!0);break}}),window.parent!==window&&(console.log("üíé [Crystal Preview] Sending READY signal to Vandal..."),window.parent.postMessage({source:"zflex-preview",action:"ready"},"*"))}const{initGlobalCart:cn,initCartPage:ln,initAddToCartButton:dn}=gt,{initStacy:un}=Vt,{initDialog:fn}=Qt,{initPwa:mn}=Wt,{initAnalytics:pn}=kt;let Oe=!1,G=null;const ze={"product-detail":async()=>{const{initProductGallery:e}=await W(async()=>{const{initProductGallery:t}=await import("./product-gallery-CW4kno63.js");return{initProductGallery:t}},[]);return dn(),e(),{destroy:()=>console.log("[App] Cleanup: product-detail")}},"category-view":async()=>{const{initFilterSort:e}=await W(async()=>{const{initFilterSort:t}=await import("./filter-sort-DL9hXtgq.js");return{initFilterSort:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: category-view")}},cart:async()=>(ln(),{destroy:()=>console.log("[App] Cleanup: cart")}),checkout:async()=>{const{initCheckout:e}=await W(async()=>{const{initCheckout:t}=await import("./checkout-CT6laXd9.js");return{initCheckout:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: checkout")}},"order-success":async()=>{const{initOrderSuccess:e}=await W(async()=>{const{initOrderSuccess:t}=await import("./order-success-BD6sfFrQ.js");return{initOrderSuccess:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: order-success")}},verify:async()=>{const{initVerifyPage:e}=await W(async()=>{const{initVerifyPage:t}=await import("./verify-DHN7ZqrI.js");return{initVerifyPage:t}},__vite__mapDeps([0,1]));return e(),{destroy:()=>console.log("[App] Cleanup: verify")}},"not-found":async()=>({destroy:()=>console.log("[App] Cleanup: not-found")}),unknown:async()=>({destroy:()=>{}})};async function Ne(){G&&typeof G.destroy=="function"&&G.destroy();const t=document.querySelector("#app-content main")?.dataset?.pageType||"unknown";console.log(`[App] Chargement des scripts pour la page: "${t}"`);const n=ze[t]||ze.unknown;try{G=await n()}catch(r){console.error(`[App] Erreur lors du chargement du module pour "${t}":`,r),G=null}an()}function He(){if(Oe)return;console.log("[App] D√©marrage zFlex ‚Äî L'Architecture Finale.");const e=new URLSearchParams(window.location.search).get("preview")==="true";e?(console.log("[App] Mode Preview activ√© - D√©sactivation des interactions utilisateur"),document.body.style.pointerEvents="none",document.body.style.cursor="not-allowed",sn()):console.log("[App] Mode normal - Initialisation des scripts interactifs");try{if(!window.firebase||!window.firebase.initializeApp)throw new Error("Le SDK Firebase (compat) n'a pas √©t√© charg√©. V√©rifie les scripts dans _head.njk.");const n=document.getElementById("firebase-config-data");if(!n)throw new Error("Firebase config data island not found.");const r=JSON.parse(n.textContent||"{}");if(!r.apiKey)throw new Error("Firebase apiKey is missing.");window.firebase.initializeApp(r),console.log("[Firebase] Initialisation via le scope global r√©ussie.")}catch(n){console.error("[Firebase] √âCHEC CRITIQUE DE L'INITIALISATION :",n);return}e||(cn(),un(Tt),rn(),Zt(),fn(),mn(),pn(),Ye(),window.addEventListener("zflex:page-loaded",(n=>{console.log(`[App] Page charg√©e via Router: ${n.detail?.path}`),Ne()}))),Ne(),Oe=!0;const t=["color: #00BFFF","font-size: 12px","font-family: monospace","background: #0E0E0E","padding: 4px 8px","border-radius: 4px"].join(";");console.log("%c Fearless Engine: Online. Status: Flawless. ",t),window.location.hostname==="localhost"||window.location.hostname.includes("192.168.")?(console.log("------------------"),console.log("< Happy Hacking! ‚Äî Fearless >"),console.log("------------------"),console.log("        \\   ^__^"),console.log("         \\  (oo)\\_______"),console.log("            (__)\\       )/\\"),console.log("                ||----w |"),console.log("                ||     ||"),console.log(`
version: dev (local)`)):(console.log("------------------"),console.log("< Ready for Action! ‚Äî Fearless >"),console.log("------------------"),console.log("        \\   ^__^"),console.log("         \\  (oo)\\_______"),console.log("            (__)\\       )/\\"),console.log("                ||----w |"),console.log("                ||     ||"),console.log(`
version: production (${new Date().toISOString().slice(0,10)})`))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",He,{once:!0}):He();export{W as _,wn as a,vn as b,gn as c,ut as d,Z as e,je as f,V as g,yn as h,hn as i,Xe as n,D as s};
